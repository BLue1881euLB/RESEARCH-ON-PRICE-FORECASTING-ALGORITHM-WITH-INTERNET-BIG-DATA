function varargout = GUI(varargin)
% GUI MATLAB code for GUI.fig
%      GUI, by itself, creates a new GUI or raises the existing
%      singleton*.
%
%      H = GUI returns the handle to a new GUI or the handle to
%      the existing singleton*.
%
%      GUI('CALLBACK',hObject,eventData,handles,...) calls the local
%      function named CALLBACK in GUI.M with the given input arguments.
%
%      GUI('Property','Value',...) creates a new GUI or raises the
%      existing singleton*.  Starting from the left, property value pairs are
%      applied to the GUI before GUI_OpeningFcn gets called.  An
%      unrecognized property name or invalid value makes property application
%      stop.  All inputs are passed to GUI_OpeningFcn via varargin.
%
%      *See GUI Options on GUIDE's Tools menu.  Choose "GUI allows only one
%      instance to run (singleton)".
%
% See also: GUIDE, GUIDATA, GUIHANDLES

% Edit the above text to modify the response to help GUI

% Last Modified by GUIDE v2.5 15-Nov-2016 10:58:28

% Begin initialization code - DO NOT EDIT
gui_Singleton = 1;
gui_State = struct('gui_Name',       mfilename, ...
                   'gui_Singleton',  gui_Singleton, ...
                   'gui_OpeningFcn', @GUI_OpeningFcn, ...
                   'gui_OutputFcn',  @GUI_OutputFcn, ...
                   'gui_LayoutFcn',  [] , ...
                   'gui_Callback',   []);
if nargin && ischar(varargin{1})
    gui_State.gui_Callback = str2func(varargin{1});
end

if nargout
    [varargout{1:nargout}] = gui_mainfcn(gui_State, varargin{:});
else
    gui_mainfcn(gui_State, varargin{:});
end
% End initialization code - DO NOT EDIT


% --- Executes just before GUI is made visible.
function GUI_OpeningFcn(hObject, eventdata, handles, varargin)
% This function has no output args, see OutputFcn.
% hObject    handle to figure
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% varargin   command line arguments to GUI (see VARARGIN)

% Choose default command line output for GUI
handles.output = hObject;

% Update handles structure
guidata(hObject, handles);

% UIWAIT makes GUI wait for user response (see UIRESUME)
% uiwait(handles.figure1);


% --- Outputs from this function are returned to the command line.
function varargout = GUI_OutputFcn(hObject, eventdata, handles) 
% varargout  cell array for returning output args (see VARARGOUT);
% hObject    handle to figure
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Get default command line output from handles structure
varargout{1} = handles.output;


% --- Executes on button press in pushbutton1.
function pushbutton1_Callback(hObject, eventdata, handles)
% p=[1183 1303 1278;1303 1278 1284;1278 1284 1187 ;...
%     1284 1187 1154;1187 1154 1267;1154 1267 1241;...
%     1267 1241 1302;1241 1302 1195;1302 1195 1256]'*0.001;
% t=[ 1284 1187 1154 1267 1241 1302 1195 1256 1348]*0.001;
% net=newff(minmax(p),[15,1],{'tansig','purelin'},'trainlm');
% net.trainParam.goal=0.001;
% net.trainParam.show=50;
% % net.trainParam.lr = 0.1
% net.trainParam.mc=0.9
% net.trainParam.min_grad=1e-10;
% net.trainParam.epochs=10000;
% [net,tr]=train(net,p,t);
% t1=sim(net,[1302 1195 1256]'*0.001);
% t2013=t1*1000%2013
% t2=sim(net,p)
% plot(2004:2012,t2,'+',2004:2012,t)

% X0=[101.43 99.98 101.13 102.23 103.65 104.75 109.38 107.6 105.5 107.58 106.5]
% x=[2000	2000	2050	2050	2050	2050	2000	2050	2050	2000	2000	2000	2000	2000	2050	2050	2000	2000	2000	2000	2050	2050	2000	2000	2050	2050	2050	2050	2000	2000	2050	2000	2050	2050	2000	2050	2025	2000	2000	2000	2050	2000	2000	2050	2000	2050	2000	2050	2000	2050	2050	2050	2050	2050	2050	2050	2050	2000	2050	2050	2000]
x1=[2000	2000	2050	2050	2050	2050	2000	2050	2050	2000	2000	2000	2000	2000	2050	2050	2000	2000	2000	2000	2050	2050	2000	2000	2050	2050	2050	2050	2000	2000	2050	2000	2050	2050	2000	2050	2025	2000	2000	2000	2050	2000	2000	2050	2000	2050	2000	2050	2000	2050	2050	2050	2050	2050	2050	2050	2050	2000	2050	2050	2000]
x2=[3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3350	3420	3420	3420	3420	3420	3420	3420	3420	3420	3420	3420	3420	3420	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320]
x3=[2499	2499	2499	2499	2499	2998	2499	2499	2999	2499	2499	2499	2499	2499	2499	2499	2499	2499	2999	2499	2499	3298	2999	2499	2499	2499	2999	2499	2999	2499	2999	2998	2499	2499	2999	2499	2749	2999	2999	2499	2499	2499	2499	2499	2999	2499	2499	2499	2499	1999	1999	1999	1999	2149	2299	1999	2499	1999	2499	2299	2299]
x4=[3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	2888	3588	2888	3588	3588	3588	3588	2888	2888	3800	2970	2970	2970	2970	3800	2970	2970	2970	2970	2970	2970	2970	3385	3800	2970	3800	2970	3800	2970]

[T,minp,maxp]=premnmx(x1)
Q=length(T)
P=zeros(7,Q);
P(1,2:Q)=T(1:Q-1);
P(2,3:Q)=T(1:Q-2);
P(3,4:Q)=T(1:Q-3);
P(4,5:Q)=T(1:Q-4);
P(5,6:Q)=T(1:Q-5);
P(6,7:Q)=T(1:Q-6);
P(7,8:Q)=T(1:Q-7);
rand('state',0);
% 
% net=newff(minmax(P),[17,1],{'tansig','purelin'},'trainlm');
net=newff(minmax(P),[17,1],{'tansig','purelin'});
net.trainParam.goal=0.001;
net.trainParam.show=50;
net.trainParam.lr = 0.01
net.trainParam.mc=0.9
net.trainParam.min_grad=1e-10;
net.trainParam.epochs=10000;
[net,tr]=train(net,P,T);
Y=sim(net,P)

figure(1)
e=T-Y
R=norm(e)
X1=postmnmx(Y,minp,maxp)
m=1:Q
subplot(221)
plot(m,x1,'-+',m,X1,'-o')
ylabel('价格(元)')
xlabel('时间(天)')
legend('真实值','预测值')
title('HTC')
hold on



[T,minp,maxp]=premnmx(x2)
Q=length(T)
P=zeros(7,Q);
P(1,2:Q)=T(1:Q-1);
P(2,3:Q)=T(1:Q-2);
P(3,4:Q)=T(1:Q-3);
P(4,5:Q)=T(1:Q-4);
P(5,6:Q)=T(1:Q-5);
P(6,7:Q)=T(1:Q-6);
P(7,8:Q)=T(1:Q-7);
rand('state',0);
% 
% net=newff(minmax(P),[17,1],{'tansig','purelin'},'trainlm');
net=newff(minmax(P),[17,1],{'tansig','purelin'});
net.trainParam.goal=0.001;
net.trainParam.show=50;
net.trainParam.lr = 0.01
net.trainParam.mc=0.9
net.trainParam.min_grad=1e-10;
net.trainParam.epochs=10000;
[net,tr]=train(net,P,T);
Y=sim(net,P)

e=T-Y
R=norm(e)
X2=postmnmx(Y,minp,maxp)
m=1:Q
subplot(222)
plot(m,x2,'-+',m,X2,'-o')
ylabel('价格(元)')
xlabel('时间(天)')
legend('真实值','预测值')
title('Iphone 5S')
hold on

[T,minp,maxp]=premnmx(x3)
Q=length(T)
P=zeros(7,Q);
P(1,2:Q)=T(1:Q-1);
P(2,3:Q)=T(1:Q-2);
P(3,4:Q)=T(1:Q-3);
P(4,5:Q)=T(1:Q-4);
P(5,6:Q)=T(1:Q-5);
P(6,7:Q)=T(1:Q-6);
P(7,8:Q)=T(1:Q-7);
rand('state',0);
% 
% net=newff(minmax(P),[17,1],{'tansig','purelin'},'trainlm');
net=newff(minmax(P),[17,1],{'tansig','purelin'});
net.trainParam.goal=0.001;
net.trainParam.show=50;
net.trainParam.lr = 0.01
net.trainParam.mc=0.9
net.trainParam.min_grad=1e-10;
net.trainParam.epochs=10000;
[net,tr]=train(net,P,T);
Y=sim(net,P)

e=T-Y
R=norm(e)
X3=postmnmx(Y,minp,maxp)
m=1:Q
subplot(223)
plot(m,x3,'-+',m,X3,'-o')
ylabel('价格(元)')
xlabel('时间(天)')
legend('真实值','预测值')
title('OPPO')
hold on


[T,minp,maxp]=premnmx(x4)
Q=length(T)
P=zeros(7,Q);
P(1,2:Q)=T(1:Q-1);
P(2,3:Q)=T(1:Q-2);
P(3,4:Q)=T(1:Q-3);
P(4,5:Q)=T(1:Q-4);
P(5,6:Q)=T(1:Q-5);
P(6,7:Q)=T(1:Q-6);
P(7,8:Q)=T(1:Q-7);
rand('state',0);
% 
% net=newff(minmax(P),[17,1],{'tansig','purelin'},'trainlm');
net=newff(minmax(P),[17,1],{'tansig','purelin'});
net.trainParam.goal=0.001;
net.trainParam.show=50;
net.trainParam.lr = 0.01
net.trainParam.mc=0.9
net.trainParam.min_grad=1e-10;
net.trainParam.epochs=10000;
[net,tr]=train(net,P,T);
Y=sim(net,P)

e=T-Y
R=norm(e)
X4=postmnmx(Y,minp,maxp)
m=1:Q
subplot(224)
plot(m,x4,'-+',m,X4,'-o')
ylabel('价格(元)')
xlabel('时间(天)')
legend('真实值','预测值')
title('华为 P8')
hold on
% hObject    handle to pushbutton1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --- Executes on button press in pushbutton2.
function pushbutton2_Callback(hObject, eventdata, handles)
% X=[ 2000	2000	2050	2050	2050	2050	2000	2050	2050	2000	2000	2000	2000	2000	2050	2050	2000	2000	2000	2000	2050	2050	2000	2000	2050	2050	2050	2050	2000	2000	2050	2000	2050	2050	2000	2050	2025	2000	2000	2000	2050	2000	2000	2050	2000	2050	2000	2050	2000	2050	2050	2050	2050	2050	2050	2050	2050	2000	2050	2050	2000
%     ]';
X=[14.06	14.65	15.45	13.91	13.33	12	11.43	11.14	11.4	10.57	10.65	11.72	12.89	12.58	13.05	13.48	12.13	10.93	9.84	9.98	9.45	9.76	10.74	10.98	10.47	10.14	10.83	10.88	11.25	11.09	11.25	11.4	11.33	10.2	9.98	9.68	10.65	11.4	11.3	10.6	10.6	10.49	10.28	10.26	9.95	10.26	10.12	10.05	10.26	10.57	11.06	10.8	10.85	10.9	11.13	11.09	11.17	11.44	11.61	11.53	11.7	11.7	11.9	12.13	12.24	12.09	12.14	12.03	12.13	11.88	11.96	11.25	11.05	11.32	11.91	11.91	11.81	11.9	12	12.32	12.47	12.39	11.98	11.51	11.51	11.57	11.62	11.57	11.52	11.57	11.33	11.3	11.11	11.1	11.33	11.1	11.1	11.19	11.06	11.4
]';
% XX=[3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3350	3420	3420	3420	3420	3420	3420	3420	3420	3420	3420	3420	3420	3420	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320
%     ]';
XX=[9.63	9.86	10.01	9.07	9.49	8.84	8.99	8.87	9.14	8.59	8.61	9.36	8.95	8.81	9.01	9.11	8.52	8.75	8.37	8.71	8.6	9.04	9.14	9.08	9	8.81	9.05	9.08	9.2	9.05	9.35	9.35	9.38	8.7	8.8	9.08	9.48	10.43	10.35	10.27	10.18	10.06	9.88	9.46	9.35	9.59	9.72	9.65	9.69	9.8	10.01	9.82	9.72	9.55	9.61	9.37	9.13	9.39	9.28	9.32	9.46	9.45	9.37	9.22	9.36	9.24	9.4	9.49	9.49	9.29	9.29	9.15	9.03	9.15	9.05	9.1	9.11	9	8.95	9.09	9.12	9.22	9.05	8.85	8.84	8.86	8.9	8.9	8.96	8.55	8.45	8.34	8.42	8.41	8.3	8.22	8.23	8.19	8.49	8.44
]';
% XXX=[
%     2499	2499	2499	2499	2499	2998	2499	2499	2999	2499	2499	2499	2499	2499	2499	2499	2499	2499	2999	2499	2499	3298	2999	2499	2499	2499	2999	2499	2999	2499	2999	2998	2499	2499	2999	2499	2749	2999	2999	2499	2499	2499	2499	2499	2999	2499	2499	2499	2499	1999	1999	1999	1999	2149	2299	1999	2499	1999	2499	2299	2299
%     ]';
XXX=[6.1	6.02	6.19	5.59	5.68	5.12	5.18	5.07	5.22	4.9	5.02	5.52	5.43	5.09	5.24	5.46	5.01	5.08	4.98	5.08	4.87	5.02	5.11	5.14	5.05	4.92	5.13	5.2	5.15	5.22	5.74	5.56	5.54	4.99	5.05	4.9	5.17	5.69	5.6	5.42	5.53	5.51	5.33	5.11	5.06	5.16	5.12	5.05	5.16	5.36	5.58	5.41	5.46	5.44	5.46	5.33	5.18	5.37	5.39	5.38	5.48	5.49	5.35	5.4	5.46	5.44	5.48	5.54	5.54	5.45	5.46	5.17	5.13	5.19	5.2	5.25	5.2	5.19	5.2	5.28	5.28	5.28	5.1	4.85	4.82	4.81	4.77	4.71	4.75	4.73	4.61	4.61	4.64	4.7	4.65	4.65	4.65	4.64	4.61	4.75
]';
% XXXX=[
%     3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	2888	3588	2888	3588	3588	3588	3588	2888	2888	3800	2970	2970	2970	2970	3800	2970	2970	2970	2970	2970	2970	2970	3385	3800	2970	3800	2970	3800	2970
%     ]';
XXXX=[19.12	18.84	19.23	17.31	17.33	15.84	16.46	15.76	16.35	15.47	15.56	16.28	15.92	15.96	16.91	16.98	15.99	15.81	15.86	16.39	16.26	16.97	17.39	17.37	17	16.59	17.37	17.4	17.24	17.2	17.58	17.21	17.26	15.68	15.97	15.47	15.78	17.36	18.93	18.46	18.39	18.11	17.65	16.83	16.56	17.05	17.06	17.47	17.68	18.05	18.23	17.88	17.86	17.46	17.69	17.21	16.69	17.16	17.2	17.32	17.68	17.59	17.2	17.16	17.39	17.64	17.84	17.88	18.37	18.16	19.98	21.98	20.66	21	20.27	20.57	20.29	19.82	19.39	19.83	20.1	20.43	19.55	18.69	18.63	18.6	18.77	18.64	18.73	19.65	19	19.41	19.38	19.4	19.22	18.82	6.55	6.17	5.94	6.17
]';
% plot(1:length(X),X);

%做对数差分
Y=diff(log(X))
YY=diff(log(XX))
YYY=diff(log(XXX))
YYYY=diff(log(XXXX))
% figure(4)
% plot(1:length(Y),Y)
% 
% figure(3)
% autocorr(Y)

% figure(2)
Z=iddata(Y)
ZZ=iddata(YY)
ZZZ=iddata(YYY)
ZZZZ=iddata(YYYY)

figure(1)
% m = armax(Z,[13,9])
m = armax(Z,'na',20,'nc',10)
mm = armax(Z,[20,10])
mmm = armax(Z,[20,10])
mmmm = armax(Z,[20,10])

% m = arx(Z,3)

L = 15
y = [Y;zeros(L,1)];
p=iddata(y);
P=predict(m,p,L)
G=get(P)
PT = G.OutputData{1,1}(length(Y)+1:length(Y)+L,1)
D=[Y;PT]
X1 = cumsum([X(1);D])
X2 = X1(length(X)+1 : end)

subplot(221);

compare(m,Z,L)

title('宝安地产')
hold on
%
L = 15
yy = [YY;zeros(L,1)];
pp=iddata(yy);
PP=predict(mm,pp,L)
GG=get(PP)
PTT = GG.OutputData{1,1}(length(YY)+1:length(YY)+L,1)
D=[YY;PTT]
XX1 = cumsum([XX(1);D])
XX2 = XX1(length(XX)+1 : end)

subplot(222);

compare(mm,ZZ,L)
title('保利地产')
hold on

%
L = 15
yyy = [YYY;zeros(L,1)];
ppp=iddata(yyy);
PPP=predict(mmm,ppp,L)
GGG=get(PPP)
PTTT = GGG.OutputData{1,1}(length(YYY)+1:length(YYY)+L,1)
D=[YYY;PTTT]
XXX1 = cumsum([XXX(1);D])
XXX2 = XXX1(length(XXX)+1 : end)

subplot(223);

compare(mmm,ZZZ,L)
title('华远地产')
hold on

%
L = 15
yyyy = [YYYY;zeros(L,1)];
pppp=iddata(yyyy);
PPPP=predict(mmmm,pppp,L)
GGGG=get(PPPP)
PTTTT = GGGG.OutputData{1,1}(length(YYY)+1:length(YYY)+L,1)
D=[YYYY;PTTTT]
XXXX1 = cumsum([XXXX(1);D])
XXXX2 = XXXX1(length(XXXX)+1 : end)

subplot(224);

compare(mmmm,ZZZZ,L)
title('格力地产')
hold on
% hObject    handle to pushbutton2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --- Executes on button press in pushbutton3.
function pushbutton3_Callback(hObject, eventdata, handles)
load emodata
X=[ 2000	2000	2050	2050	2050	2050	2000	2050	2050	2000	2000	2000	2000	2000	2050	2050	2000	2000	2000	2000	2050	2050	2000	2000	2050	2050	2050	2050	2000	2000	2050	2000	2050	2050	2000	2050	2025	2000	2000	2000	2050	2000	2000	2050	2000	2050	2000	2050	2000	2050	2050	2050	2050	2050	2050	2050	2050	2000	2050	2050	2000
    ]';
% X=[14.06	14.65	15.45	13.91	13.33	12	11.43	11.14	11.4	10.57	10.65	11.72	12.89	12.58	13.05	13.48	12.13	10.93	9.84	9.98	9.45	9.76	10.74	10.98	10.47	10.14	10.83	10.88	11.25	11.09	11.25	11.4	11.33	10.2	9.98	9.68	10.65	11.4	11.3	10.6	10.6	10.49	10.28	10.26	9.95	10.26	10.12	10.05	10.26	10.57	11.06	10.8	10.85	10.9	11.13	11.09	11.17	11.44	11.61	11.53	11.7	11.7	11.9	12.13	12.24	12.09	12.14	12.03	12.13	11.88	11.96	11.25	11.05	11.32	11.91	11.91	11.81	11.9	12	12.32	12.47	12.39	11.98	11.51	11.51	11.57	11.62	11.57	11.52	11.57	11.33	11.3	11.11	11.1	11.33	11.1	11.1	11.19	11.06	11.4
% ]';
XX=[3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3350	3420	3420	3420	3420	3420	3420	3420	3420	3420	3420	3420	3420	3420	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320
    ]';
XXX=[
    2499	2499	2499	2499	2499	2998	2499	2499	2999	2499	2499	2499	2499	2499	2499	2499	2499	2499	2999	2499	2499	3298	2999	2499	2499	2499	2999	2499	2999	2499	2999	2998	2499	2499	2999	2499	2749	2999	2999	2499	2499	2499	2499	2499	2999	2499	2499	2499	2499	1999	1999	1999	1999	2149	2299	1999	2499	1999	2499	2299	2299
    ]';
XXXX=[
    3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	2888	3588	2888	3588	3588	3588	3588	2888	2888	3800	2970	2970	2970	2970	3800	2970	2970	2970	2970	2970	2970	2970	3385	3800	2970	3800	2970	3800	2970
    ]';
% plot(1:length(X),X);

%做对数差分
Y=diff(log(X))
YY=diff(log(XX))
YYY=diff(log(XXX))
YYYY=diff(log(XXXX))
% figure(4)
% plot(1:length(Y),Y)
% 
% figure(3)
% autocorr(Y)

% figure(2)
Z=iddata(Y)
ZZ=iddata(YY)
ZZZ=iddata(YYY)
ZZZZ=iddata(YYYY)

figure(1)
% m = armax(Z,[13,9])
 testm = []
    for p = 1:10
        for q = 1:6
            m = armax(Z(1:61),[p,q])     %数据长度T/求长度为共 61天T/10
            AIC = aic(m)
            testm = [testm; p q AIC]
        end
    end
    for k = 1 : size(testm,1)
        if testm(k,3) == min(testm(:,3))
            p_testm = testm(k,1)
            q_testm = testm(k,2)
        end
    end
m = armax(Z,[p_testm q_testm])
% m = armax(Z,'na',13,'nc',9)
 testmm = []
    for p = 1:10
        for q = 1:6
            mm = armax(Z(1:61),[p,q])     %数据长度T/求长度为共 61天T/10
            AIC = aic(mm)
            testmm = [testmm; p q AIC]
        end
    end
    for k = 1 : size(testmm,1)
        if testmm(k,3) == min(testmm(:,3))
            p_testmm = testmm(k,1)
            q_testmm = testmm(k,2)
        end
    end
    
mm = armax(Z,[p_testmm q_testmm])

 testmmm = []
    for p = 1:10
        for q = 1:6
            mmm = armax(Z(1:61),[p,q])     %数据长度T/求长度为共 61天T/10
            AIC = aic(mmm)
            testmmm = [testmmm; p q AIC]
        end
    end
    for k = 1 : size(testmmm,1)
        if testmmm(k,3) == min(testmmm(:,3))
            p_testmmm = testmmm(k,1)
            q_testmmm = testmmm(k,2)
        end
    end

mmm = armax(Z,[p_testmmm q_testmmm])

testmmmm = []
    for p = 1:10
        for q = 1:6
            mmmm = armax(Z(1:61),[p,q])     %数据长度T/求长度为共 61天T/10
            AIC = aic(mmmm)
            testmmmm = [testmmmm; p q AIC]
        end
    end
    for k = 1 : size(testmmmm,1)
        if testmmmm(k,3) == min(testmmmm(:,3))
            p_testmmmm = testmmmm(k,1)
            q_testmmmm = testmmmm(k,2)
        end
    end
mmmm = armax(Z,[p_testmmmm q_testmmmm])

% m = arx(Z,3)



L = 15
y = [Y;zeros(L,1)];
p=iddata(y);
P=predict(m,p,L)

G=get(P)
PT = G.OutputData{1,1}(length(Y)+1:length(Y)+L,1)
D=[Y;PT]
X1 = cumsum([X(1);D])

X2 = X1(length(X)+1 : end)
for i=1:15
    if i>=3&i<=7
        X2(i)=X2(i)-100
    end
    if i>7
        X2(i)=X2(i)-200
    end
end


subplot(221);

compare(m,Z,L)
title('HTC拟合')
hold on
%
L = 15
yy = [YY;zeros(L,1)];
pp=iddata(yy);
PP=predict(mm,pp,L)
GG=get(PP)
PTT = GG.OutputData{1,1}(length(YY)+1:length(YY)+L,1)
D=[YY;PTT]
XX1 = cumsum([XX(1);D])
XX2 = XX1(length(XX)+1 : end)
for i=1:15
    if i>=3&i<=7
        XX2(i)=XX2(i)-200
    end
    if i>7
        XX2(i)=XX2(i)-250
    end
end

subplot(222);

compare(mm,ZZ,L)
title('Iphone5S拟合')
hold on

%
L = 15
yyy = [YYY;zeros(L,1)];
ppp=iddata(yyy);
PPP=predict(mmm,ppp,L)
GGG=get(PPP)
PTTT = GGG.OutputData{1,1}(length(YYY)+1:length(YYY)+L,1)
D=[YYY;PTTT]
XXX1 = cumsum([XXX(1);D])
XXX2 = XXX1(length(XXX)+1 : end)
for i=1:15
    if i>=3&i<=7
        XXX2(i)=XXX2(i)-0
    end
    if i>7
        XXX2(i)=XXX2(i)-0
    end
end

subplot(223);

compare(mmm,ZZZ,L)
title('OPPO拟合')
hold on

%
L = 15
yyyy = [YYYY;zeros(L,1)];
pppp=iddata(yyyy);
PPPP=predict(mmmm,pppp,L)
GGGG=get(PPPP)
PTTTT = GGGG.OutputData{1,1}(length(YYY)+1:length(YYY)+L,1)
D=[YYYY;PTTTT]
XXXX1 = cumsum([XXXX(1);D])
XXXX2 = XXXX1(length(XXXX)+1 : end)
for i=1:15
    if i>=3&i<=7
        XXXX2(i)=XXXX2(i)-500
    end
    if i>7
        XXXX2(i)=XXXX2(i)-600
    end
end

subplot(224);

compare(mmmm,ZZZZ,L)
title('华为P8拟合')
hold on

% hObject    handle to pushbutton3 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --- Executes on button press in pushbutton4.
function pushbutton4_Callback(hObject, eventdata, handles)
sz=[3.59	3.69	3.55	3.68
3.7	3.73	3.64	3.65
3.68	3.68	3.63	3.65
3.65	3.72	3.57	3.6
3.57	3.6	3.51	3.55
3.59	3.65	3.54	3.56
3.57	3.62	3.45	3.46
3.48	3.52	3.38	3.41
3.47	3.48	3.34	3.37
3.36	3.53	3.36	3.5
3.45	3.54	3.44	3.48
3.47	3.47	3.37	3.38
3.37	3.44	3.35	3.43
3.42	3.5	3.42	3.46
3.52	3.52	3.38	3.39
3.39	3.46	3.39	3.45
3.47	3.59	3.41	3.56
3.6	3.61	3.52	3.58
3.53	3.6	3.49	3.5
3.48	3.49	3.38	3.38
3.45	3.45	3.27	3.39
3.37	3.42	3.36	3.41
3.36	3.39	3.28	3.33
3.34	3.39	3.1	3.22
3.22	3.28	3.07	3.09
3	3	2.38	2.87
2.85	3.07	2.76	3.03
3.02	3.19	3	3.09
2.99	3.2	2.99	3.17
3.2	3.21	3.13	3.17
3.17	3.18	3.1	3.13
3.13	3.22	3.08	3.18
3.23	3.25	3.18	3.21
3.21	3.27	3.2	3.22
3.25	3.25	3.15	3.21
3.16	3.21	3.15	3.19
3.2	3.2	3.13	3.16
3.12	3.15	3.11	3.13
3.11	3.11	3	3.03
2.98	3.1	2.98	3.01
3.03	3.07	3	3.01
3.07	3.09	3	3.04
3.08	3.08	2.99	3.04
3.05	3.07	2.98	3.01
2.97	3.05	2.97	3.02
2.99	3.05	2.99	3.01
3.03	3.03	2.98	3
2.96	3.05	2.96	3
3.03	3.07	2.99	3.06
3.08	3.15	3.03	3.04
3.01	3.03	2.85	2.94
2.92	2.97	2.88	2.93
2.97	2.97	2.91	2.94
2.96	2.96	2.89	2.92
2.95	2.96	2.88	2.9
2.88	2.94	2.84	2.91
2.93	2.94	2.84	2.86
2.83	2.87	2.75	2.79
2.7	2.7	2.61	2.65
2.52	2.73	2.52	2.62
2.6	2.66	2.55	2.56
2.63	2.73	2.63	2.71
2.77	2.88	2.76	2.81
2.8	2.8	2.69	2.72
2.73	2.75	2.66	2.69
2.6	2.68	2.52	2.64
2.61	2.67	2.57	2.58
2.55	2.65	2.55	2.6
2.59	2.71	2.59	2.69
2.71	2.79	2.7	2.73
2.68	2.73	2.64	2.72
2.75	2.78	2.72	2.75
2.77	2.79	2.72	2.74
2.73	2.76	2.7	2.71
2.72	2.76	2.69	2.73
2.75	2.78	2.73	2.75
2.67	2.74	2.66	2.69
2.64	2.73	2.64	2.72
2.74	2.82	2.74	2.77
2.76	2.76	2.68	2.71
2.73	2.73	2.69	2.71
2.69	2.72	2.66	2.7
2.65	2.69	2.61	2.69
2.73	2.79	2.68	2.79
2.85	2.94	2.84	2.85
2.88	2.92	2.84	2.87
2.9	2.9	2.8	2.84
2.85	2.92	2.84	2.92
2.91	2.94	2.87	2.91
2.97	3.01	2.92	2.95
3.02	3.06	2.98	3.02
3.04	3.05	2.98	2.99
2.99	2.99	2.94	2.97
2.94	3.01	2.94	2.98
3.04	3.07	3	3.04
3.06	3.08	3.03	3.07
3.04	3.06	3	3.04
3.01	3.05	2.98	3
3.05	3.06	3.02	3.05
3.14	3.14	3.07	3.1
3.08	3.09	2.99	3.05
3.02	3.05	2.99	3.02
3.03	3.03	2.96	2.97
2.98	3	2.94	2.96
2.96	3.03	2.92	2.94
2.96	2.99	2.93	2.97
2.97	3.03	2.97	3.02
3.04	3.07	2.99	3.07
3.1	3.1	3.02	3.03
3.07	3.07	3	3.01
2.98	3	2.93	2.93
2.93	2.95	2.91	2.91
2.96	2.99	2.91	2.94
2.94	2.94	2.85	2.91
2.83	2.9	2.83	2.89
2.93	2.97	2.9	2.91
2.94	3.02	2.88	2.94
2.97	3.04	2.96	3.01
3.03	3.03	2.96	3.02
3.03	3.04	2.99	3.02
3	3.03	2.98	3.03
3	3	2.93	2.96
2.98	2.99	2.9	2.92
2.91	2.94	2.87	2.89
2.9	2.92	2.85	2.91
2.88	3.07	2.86	3.07
3.07	3.17	3.04	3.1
3.07	3.13	3.07	3.13
3.03	3.13	3.03	3.1
3.1	3.15	3.05	3.09
3.02	3.07	3	3.04
3.01	3.07	3	3.03
3.03	3.08	3	3.02
3.02	3.02	2.85	2.88
2.82	2.9	2.8	2.89
2.9	2.98	2.89	2.95
2.97	3.07	2.96	3.07
3.08	3.15	3.05	3.1
3.05	3.09	3.02	3.08
3.08	3.12	3.05	3.1
3.15	3.15	3.08	3.1
3.12	3.12	3.09	3.12
3.14	3.14	3.07	3.12
3.12	3.15	3.1	3.11
3.12	3.15	3.07	3.13
3.1	3.14	3.1	3.12
3.14	3.18	3.1	3.18
3.19	3.2	3.02	3.04
3.08	3.17	3.04	3.06
3.05	3.11	3.03	3.11
3.06	3.09	2.9	2.97
2.97	3.11	2.93	3.05
2.93	3.03	2.93	3.01
3.06	3.08	2.98	3
3.02	3.04	2.98	2.98
2.95	3.03	2.95	3.02
3	3.02	2.95	2.95
2.9	2.94	2.85	2.93
2.96	3.02	2.93	3
2.96	2.97	2.87	2.96
2.91	2.98	2.81	2.87
2.92	3.03	2.85	2.99
3.02	3.02	2.94	2.99
2.98	2.98	2.9	2.91
2.98	2.99	2.9	2.91
2.93	2.94	2.9	2.94
2.92	3	2.9	2.98
3	3.01	2.96	3
2.99	3.01	2.95	3
3.02	3.03	2.92	2.97
2.98	3	2.96	2.99
3.03	3.03	2.98	3
3	3	2.91	2.94
2.9	2.93	2.9	2.92
2.98	2.99	2.92	2.96
2.99	3.03	2.96	2.99
3.03	3.03	2.93	2.97
3	3.02	2.96	2.97
2.97	3	2.94	2.98
2.98	3.03	2.97	2.99
3	3	2.91	2.98
2.94	2.96	2.94	2.95
2.94	2.95	2.83	2.85
2.92	2.94	2.87	2.89
2.93	2.93	2.83	2.83
2.84	2.92	2.83	2.91
2.96	3.09	2.93	3.08
3.08	3.18	3.08	3.15
3.15	3.17	3.11	3.14
3.17	3.29	3.17	3.29
3.26	3.3	3.2	3.3
3.3	3.3	3.23	3.3
3.3	3.35	3.26	3.27
3.28	3.37	3.27	3.37
3.4	3.52	3.39	3.52
3.45	3.48	3.2	3.2
3.22	3.22	2.99	3.01
3.03	3.08	3.01	3.04
3.07	3.12	3.03	3.1
3.06	3.1	3.02	3.05
3.08	3.08	3.03	3.04
3.03	3.06	3.01	3.04
3.05	3.05	2.99	3
2.98	3.07	2.98	3.05
3.08	3.08	3.02	3.07
3.03	3.1	3.03	3.08
3.06	3.06	3	3.03
3.01	3.04	2.99	2.99
3	3.02	2.99	3
3	3.05	3	3.04
3.02	3.11	3	3.1
3.08	3.14	3.05	3.12
3.14	3.14	3.07	3.1
3.14	3.15	3.12	3.15
3.15	3.16	3.12	3.13
3.15	3.16	3.05	3.13
3.16	3.16	3.08	3.15
3.18	3.18	3.13	3.15
3.13	3.17	3.09	3.14
3.15	3.17	3.13	3.16
3.14	3.17	3.12	3.16
3.17	3.17	3.11	3.13
3.11	3.14	3.08	3.11
3.12	3.12	3.08	3.09
3.11	3.13	3.07	3.1
3.11	3.11	3.05	3.07
3.09	3.11	3.06	3.1
3.1	3.14	3.07	3.14
3.1	3.14	3.08	3.14
3.14	3.14	3.08	3.11
3.08	3.13	3.08	3.08
3.07	3.08	3.04	3.06
3.06	3.09	3.05	3.06
3.07	3.08	3.01	3.07
3.07	3.07	2.97	3.01
3	3.01	2.99	3
3.02	3.02	2.97	3.01
2.97	3.02	2.97	3.01
2.97	3	2.96	2.97
2.95	3	2.95	2.99
3	3.03	2.96	3
3	3.01	2.99	3.01
3	3.03	2.98	3.01
3.03	3.08	3.01	3.07
3.08	3.14	3.07	3.12
3.13	3.15	3.11	3.14
3.13	3.15	3.1	3.11
3.1	3.11	3.03	3.1
3.1	3.1	3.07	3.09
3.09	3.13	3.06	3.08
3.09	3.11	3.07	3.09
3.13	3.13	3.08	3.1]
[m,n]=size(sz);
ts = sz(2:m,4);
tsx=sz(1:m-1,:);
%shuju gui 1hua
TS= ts';
TSX=tsx';
%dui ts gui 1 hua
[Pn1,minp1,maxp1]=premnmx(TS)
[Pn2,minp2,maxp2]=premnmx(TSX)

rand('state',0);
%PR=[-1,1;-1,1;-1,1;-1,1;-1,1];
PR=[-1,1;-1,1;-1,1;-1,1];
net = newff(PR,[80,1],{'tansig','purelin'},'traingdx','learngdm','mse')
net.trainparam.show = 50;
net.trainparam.lr =0.1;
net.trainparam.mc=0.9;
net.trainparam.epochs=10000;
net=init(net);
% net=train(net,Pn2(:,1:40),Pn1(1:40));%chuangjian wangluo
% %fangzhen
% test = Pn2(:,31:end);
net=train(net,Pn2(:,1:240),Pn1(1:240));%chuangjian wangluo 252-240
%fangzhen
% test = Pn2(:,31:end);
test = Pn2(:,230:end);%252-230
Y=sim(net,test)
%fang gui1 hua
P=postmnmx(Y,minp1,maxp1)
%xiang dui wu cha 
e = (sz(231:m)-P)./sz(231:m)
res = norm(e)

% huachu kaipan
figure(1)
% t = 32:m
t = 231:m
% plot(t',sz(32:m),'-+',t,P,'o')
plot(t',sz(231:m),'-+',t,P,'o')
legend('真实值','预测值')
xlabel('时间(days)')
ylabel('收盘价(元)')

% hObject    handle to pushbutton4 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --- Executes on button press in pushbutton5.
function pushbutton5_Callback(hObject, eventdata, handles)
% hObject    handle to pushbutton5 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --- Executes on button press in pushbutton6.
function pushbutton6_Callback(hObject, eventdata, handles)
load emodataf
sz=[3.59	3.69	3.55	3.68	3.68
3.7	3.73	3.64	3.65	3.65
3.68	3.68	3.63	3.65	3.65
3.65	3.72	3.57	3.6	3.6
3.57	3.6	3.51	3.55	3.55
3.59	3.65	3.54	3.56	3.56
3.57	3.62	3.45	3.46	3.46
3.48	3.52	3.38	3.41	3.41
3.47	3.48	3.34	3.37	3.37
3.36	3.53	3.36	3.5	3.5
3.45	3.54	3.44	3.48	3.48
3.47	3.47	3.37	3.38	3.38
3.37	3.44	3.35	3.43	3.43
3.42	3.5	3.42	3.46	3.46
3.52	3.52	3.38	3.39	3.39
3.39	3.46	3.39	3.45	3.45
3.47	3.59	3.41	3.56	3.56
3.6	3.61	3.52	3.58	3.58
3.53	3.6	3.49	3.5	3.5
3.48	3.49	3.38	3.38	3.38
3.45	3.45	3.27	3.39	3.39
3.37	3.42	3.36	3.41	3.41
3.36	3.39	3.28	3.33	3.33
3.34	3.39	3.1	3.22	3.22
3.22	3.28	3.07	3.09	3.09
3	3	2.38	2.87	2.87
2.85	3.07	2.76	3.03	3.03
3.02	3.19	3	3.09	3.09
2.99	3.2	2.99	3.17	3.17
3.2	3.21	3.13	3.17	3.17
3.17	3.18	3.1	3.13	3.13
3.13	3.22	3.08	3.18	3.18
3.23	3.25	3.18	3.21	3.21
3.21	3.27	3.2	3.22	3.22
3.25	3.25	3.15	3.21	3.21
3.16	3.21	3.15	3.19	3.19
3.2	3.2	3.13	3.16	3.16
3.12	3.15	3.11	3.13	3.13
3.11	3.11	3	3.03	3.03
2.98	3.1	2.98	3.01	3.01
3.03	3.07	3	3.01	3.01
3.07	3.09	3	3.04	3.04
3.08	3.08	2.99	3.04	3.04
3.05	3.07	2.98	3.01	3.01
2.97	3.05	2.97	3.02	3.02
2.99	3.05	2.99	3.01	3.01
3.03	3.03	2.98	3	3
2.96	3.05	2.96	3	3
3.03	3.07	2.99	3.06	3.06
3.08	3.15	3.03	3.04	3.04
3.01	3.03	2.85	2.94	2.94
2.92	2.97	2.88	2.93	2.93
2.97	2.97	2.91	2.94	2.94
2.96	2.96	2.89	2.92	2.92
2.95	2.96	2.88	2.9	2.9
2.88	2.94	2.84	2.91	2.91
2.93	2.94	2.84	2.86	2.86
2.83	2.87	2.75	2.79	2.79
2.7	2.7	2.61	2.65	2.65
2.52	2.73	2.52	2.62	2.62
2.6	2.66	2.55	2.56	2.56
2.63	2.73	2.63	2.71	2.71
2.77	2.88	2.76	2.81	2.81
2.8	2.8	2.69	2.72	2.72
2.73	2.75	2.66	2.69	2.69
2.6	2.68	2.52	2.64	2.64
2.61	2.67	2.57	2.58	2.58
2.55	2.65	2.55	2.6	2.6
2.59	2.71	2.59	2.69	2.69
2.71	2.79	2.7	2.73	2.73
2.68	2.73	2.64	2.72	2.72
2.75	2.78	2.72	2.75	2.75
2.77	2.79	2.72	2.74	2.74
2.73	2.76	2.7	2.71	2.71
2.72	2.76	2.69	2.73	2.73
2.75	2.78	2.73	2.75	2.75
2.67	2.74	2.66	2.69	2.69
2.64	2.73	2.64	2.72	2.72
2.74	2.82	2.74	2.77	2.77
2.76	2.76	2.68	2.71	2.71
2.73	2.73	2.69	2.71	2.71
2.69	2.72	2.66	2.7	2.7
2.65	2.69	2.61	2.69	2.69
2.73	2.79	2.68	2.79	2.79
2.85	2.94	2.84	2.85	2.85
2.88	2.92	2.84	2.87	2.87
2.9	2.9	2.8	2.84	2.84
2.85	2.92	2.84	2.92	2.92
2.91	2.94	2.87	2.91	2.91
2.97	3.01	2.92	2.95	2.95
3.02	3.06	2.98	3.02	3.02
3.04	3.05	2.98	2.99	2.99
2.99	2.99	2.94	2.97	2.97
2.94	3.01	2.94	2.98	2.98
3.04	3.07	3	3.04	3.04
3.06	3.08	3.03	3.07	3.07
3.04	3.06	3	3.04	3.04
3.01	3.05	2.98	3	3
3.05	3.06	3.02	3.05	3.05
3.14	3.14	3.07	3.1	3.1
3.08	3.09	2.99	3.05	3.05
3.02	3.05	2.99	3.02	3.02
3.03	3.03	2.96	2.97	2.97
2.98	3	2.94	2.96	2.96
2.96	3.03	2.92	2.94	2.94
2.96	2.99	2.93	2.97	2.97
2.97	3.03	2.97	3.02	3.02
3.04	3.07	2.99	3.07	3.07
3.1	3.1	3.02	3.03	3.03
3.07	3.07	3	3.01	3.01
2.98	3	2.93	2.93	2.93
2.93	2.95	2.91	2.91	2.91
2.96	2.99	2.91	2.94	2.94
2.94	2.94	2.85	2.91	2.91
2.83	2.9	2.83	2.89	2.89
2.93	2.97	2.9	2.91	2.91
2.94	3.02	2.88	2.94	2.94
2.97	3.04	2.96	3.01	3.01
3.03	3.03	2.96	3.02	3.02
3.03	3.04	2.99	3.02	3.02
3	3.03	2.98	3.03	3.03
3	3	2.93	2.96	2.96
2.98	2.99	2.9	2.92	2.92
2.91	2.94	2.87	2.89	2.89
2.9	2.92	2.85	2.91	2.91
2.88	3.07	2.86	3.07	3.07
3.07	3.17	3.04	3.1	3.1
3.07	3.13	3.07	3.13	3.13
3.03	3.13	3.03	3.1	3.1
3.1	3.15	3.05	3.09	3.09
3.02	3.07	3	3.04	3.04
3.01	3.07	3	3.03	3.03
3.03	3.08	3	3.02	3.02
3.02	3.02	2.85	2.88	2.88
2.82	2.9	2.8	2.89	2.89
2.9	2.98	2.89	2.95	2.95
2.97	3.07	2.96	3.07	3.07
3.08	3.15	3.05	3.1	3.1
3.05	3.09	3.02	3.08	3.08
3.08	3.12	3.05	3.1	3.1
3.15	3.15	3.08	3.1	3.1
3.12	3.12	3.09	3.12	3.12
3.14	3.14	3.07	3.12	3.12
3.12	3.15	3.1	3.11	3.11
3.12	3.15	3.07	3.13	3.13
3.1	3.14	3.1	3.12	3.12
3.14	3.18	3.1	3.18	3.18
3.19	3.2	3.02	3.04	3.04
3.08	3.17	3.04	3.06	3.06
3.05	3.11	3.03	3.11	3.11
3.06	3.09	2.9	2.97	2.97
2.97	3.11	2.93	3.05	3.05
2.93	3.03	2.93	3.01	3.01
3.06	3.08	2.98	3	3
3.02	3.04	2.98	2.98	2.98
2.95	3.03	2.95	3.02	3.02
3	3.02	2.95	2.95	2.95
2.9	2.94	2.85	2.93	2.93
2.96	3.02	2.93	3	3
2.96	2.97	2.87	2.96	2.96
2.91	2.98	2.81	2.87	2.87
2.92	3.03	2.85	2.99	2.99
3.02	3.02	2.94	2.99	2.99
2.98	2.98	2.9	2.91	2.91
2.98	2.99	2.9	2.91	2.91
2.93	2.94	2.9	2.94	2.94
2.92	3	2.9	2.98	2.98
3	3.01	2.96	3	3
2.99	3.01	2.95	3	3
3.02	3.03	2.92	2.97	2.97
2.98	3	2.96	2.99	2.99
3.03	3.03	2.98	3	3
3	3	2.91	2.94	2.94
2.9	2.93	2.9	2.92	2.92
2.98	2.99	2.92	2.96	2.96
2.99	3.03	2.96	2.99	2.99
3.03	3.03	2.93	2.97	2.97
3	3.02	2.96	2.97	2.97
2.97	3	2.94	2.98	2.98
2.98	3.03	2.97	2.99	2.99
3	3	2.91	2.98	2.98
2.94	2.96	2.94	2.95	2.95
2.94	2.95	2.83	2.85	2.85
2.92	2.94	2.87	2.89	2.89
2.93	2.93	2.83	2.83	2.83
2.84	2.92	2.83	2.91	2.91
2.96	3.09	2.93	3.08	3.08
3.08	3.18	3.08	3.15	3.15
3.15	3.17	3.11	3.14	3.14
3.17	3.29	3.17	3.29	3.29
3.26	3.3	3.2	3.3	3.3
3.3	3.3	3.23	3.3	3.3
3.3	3.35	3.26	3.27	3.27
3.28	3.37	3.27	3.37	3.37
3.4	3.52	3.39	3.52	3.52
3.45	3.48	3.2	3.2	3.2
3.22	3.22	2.99	3.01	3.01
3.03	3.08	3.01	3.04	3.04
3.07	3.12	3.03	3.1	3.1
3.06	3.1	3.02	3.05	3.05
3.08	3.08	3.03	3.04	3.04
3.03	3.06	3.01	3.04	3.04
3.05	3.05	2.99	3	3
2.98	3.07	2.98	3.05	3.05
3.08	3.08	3.02	3.07	3.07
3.03	3.1	3.03	3.08	3.08
3.06	3.06	3	3.03	3.03
3.01	3.04	2.99	2.99	2.99
3	3.02	2.99	3	3
3	3.05	3	3.04	3.04
3.02	3.11	3	3.1	3.1
3.08	3.14	3.05	3.12	3.12
3.14	3.14	3.07	3.1	3.1
3.14	3.15	3.12	3.15	3.15
3.15	3.16	3.12	3.13	3.13
3.15	3.16	3.05	3.13	3.13
3.16	3.16	3.08	3.15	3.15
3.18	3.18	3.13	3.15	3.15
3.13	3.17	3.09	3.14	3.14
3.15	3.17	3.13	3.16	3.16
3.14	3.17	3.12	3.16	3.16
3.17	3.17	3.11	3.13	3.13
3.11	3.14	3.08	3.11	3.11
3.12	3.12	3.08	3.09	3.09
3.11	3.13	3.07	3.1	3.1
3.11	3.11	3.05	3.07	3.07
3.09	3.11	3.06	3.1	3.1
3.1	3.14	3.07	3.14	3.14
3.1	3.14	3.08	3.14	3.14
3.14	3.14	3.08	3.11	3.11
3.08	3.13	3.08	3.08	3.08
3.07	3.08	3.04	3.06	3.06
3.06	3.09	3.05	3.06	3.06
3.07	3.08	3.01	3.07	3.07
3.07	3.07	2.97	3.01	3.01
3	3.01	2.99	3	3
3.02	3.02	2.97	3.01	3.01
2.97	3.02	2.97	3.01	3.01
2.97	3	2.96	2.97	2.97
2.95	3	2.95	2.99	2.99
3	3.03	2.96	3	3
3	3.01	2.99	3.01	3.01
3	3.03	2.98	3.01	3.01
3.03	3.08	3.01	3.07	3.07
3.08	3.14	3.07	3.12	3.12
3.13	3.15	3.11	3.14	3.14
3.13	3.15	3.1	3.11	3.11
3.1	3.11	3.03	3.1	3.1
3.1	3.1	3.07	3.09	3.09
3.09	3.13	3.06	3.08	3.08
3.09	3.11	3.07	3.09	3.09
3.13	3.13	3.08	3.1	3.1
]
[m,n]=size(sz);
ts = sz(2:m,4);
tsx=sz(1:m-1,:);
%shuju gui 1hua
TS= ts';
TSX=tsx';
%dui ts gui 1 hua
[Pn1,minp1,maxp1]=premnmx(TS)
[Pn2,minp2,maxp2]=premnmx(TSX)

rand('state',0);
PR=[-1,1;-1,1;-1,1;-1,1;-1,1];
% PR=[-1,1;-1,1;-1,1;-1,1];
net = newff(PR,[80,1],{'tansig','purelin'},'traingdx','learngdm','mse')
net.trainparam.show = 50;
net.trainparam.lr =0.1;
net.trainparam.mc=0.9;
net.trainparam.epochs=10000;
net=init(net);
% net=train(net,Pn2(:,1:40),Pn1(1:40));%chuangjian wangluo
% %fangzhen
% test = Pn2(:,31:end);
net=train(net,Pn2(:,1:240),Pn1(1:240));%chuangjian wangluo 252-240
%fangzhen
% test = Pn2(:,31:end);
test = Pn2(:,230:end);%252-230
Y=sim(net,test)
%fang gui1 hua
P=postmnmx(Y,minp1,maxp1)
%xiang dui wu cha 
e = (sz(231:m)-P)./sz(231:m)
res = norm(e)

% huachu kaipan
figure(1)
% t = 32:m
t = 231:m
% plot(t',sz(32:m),'-+',t,P,'o')
plot(t',sz(231:m),'-+',t,P,'o')
legend('真实值','预测值')
xlabel('时间(days)')
ylabel('收盘价(元)')
% hObject    handle to pushbutton6 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --- Executes on button press in pushbutton7.
function pushbutton7_Callback(hObject, eventdata, handles)



% hObject    handle to pushbutton7 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --- Executes on button press in pushbutton8.
function pushbutton8_Callback(hObject, eventdata, handles)
X=[ 2000	2000	2050	2050	2050	2050	2000	2050	2050	2000	2000	2000	2000	2000	2050	2050	2000	2000	2000	2000	2050	2050	2000	2000	2050	2050	2050	2050	2000	2000	2050	2000	2050	2050	2000	2050	2025	2000	2000	2000	2050	2000	2000	2050	2000	2050	2000	2050	2000	2050	2050	2050	2050	2050	2050	2050	2050	2000	2050	2050	2000
    ]';
% X=[14.06	14.65	15.45	13.91	13.33	12	11.43	11.14	11.4	10.57	10.65	11.72	12.89	12.58	13.05	13.48	12.13	10.93	9.84	9.98	9.45	9.76	10.74	10.98	10.47	10.14	10.83	10.88	11.25	11.09	11.25	11.4	11.33	10.2	9.98	9.68	10.65	11.4	11.3	10.6	10.6	10.49	10.28	10.26	9.95	10.26	10.12	10.05	10.26	10.57	11.06	10.8	10.85	10.9	11.13	11.09	11.17	11.44	11.61	11.53	11.7	11.7	11.9	12.13	12.24	12.09	12.14	12.03	12.13	11.88	11.96	11.25	11.05	11.32	11.91	11.91	11.81	11.9	12	12.32	12.47	12.39	11.98	11.51	11.51	11.57	11.62	11.57	11.52	11.57	11.33	11.3	11.11	11.1	11.33	11.1	11.1	11.19	11.06	11.4
% ]';
XX=[3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3350	3420	3420	3420	3420	3420	3420	3420	3420	3420	3420	3420	3420	3420	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320
    ]';
XXX=[
    2499	2499	2499	2499	2499	2998	2499	2499	2999	2499	2499	2499	2499	2499	2499	2499	2499	2499	2999	2499	2499	3298	2999	2499	2499	2499	2999	2499	2999	2499	2999	2998	2499	2499	2999	2499	2749	2999	2999	2499	2499	2499	2499	2499	2999	2499	2499	2499	2499	1999	1999	1999	1999	2149	2299	1999	2499	1999	2499	2299	2299
    ]';
XXXX=[
    3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	2888	3588	2888	3588	3588	3588	3588	2888	2888	3800	2970	2970	2970	2970	3800	2970	2970	2970	2970	2970	2970	2970	3385	3800	2970	3800	2970	3800	2970
    ]';
% plot(1:length(X),X);

%做对数差分
Y=diff(log(X))
YY=diff(log(XX))
YYY=diff(log(XXX))
YYYY=diff(log(XXXX))
% figure(4)
% plot(1:length(Y),Y)
% 
figure(1)
% autocorr(Y)

% figure(2)
Z=iddata(Y)
ZZ=iddata(YY)
ZZZ=iddata(YYY)
ZZZZ=iddata(YYYY)


% m = armax(Z,[13,9])
m = armax(Z,'na',13,'nc',9)
mm = armax(Z,[13,9])
mmm = armax(Z,[13,9])
mmmm = armax(Z,[13,9])

% m = arx(Z,3)

L = 15
y = [Y;zeros(L,1)];
p=iddata(y);
P=predict(m,p,L)

G=get(P)
PT = G.OutputData{1,1}(length(Y)+1:length(Y)+L,1)
D=[Y;PT]
X1 = cumsum([X(1);D])

X2 = X1(length(X)+1 : end)
for i=1:15
    if i>=10
        X2(i)=X2(i)-200
    end
end


subplot(221);

compare(m,Z,L)
title('HTC拟合')
hold on
%
L = 15
yy = [YY;zeros(L,1)];
pp=iddata(yy);
PP=predict(mm,pp,L)
GG=get(PP)
PTT = GG.OutputData{1,1}(length(YY)+1:length(YY)+L,1)
D=[YY;PTT]
XX1 = cumsum([XX(1);D])
XX2 = XX1(length(XX)+1 : end)

for i=1:15
    if i>=10
        XX2(i)=XX2(i)-250
    end
end
subplot(222);

compare(mm,ZZ,L)
title('Iphone5S拟合')
hold on

%
L = 15
yyy = [YYY;zeros(L,1)];
ppp=iddata(yyy);
PPP=predict(mmm,ppp,L)
GGG=get(PPP)
PTTT = GGG.OutputData{1,1}(length(YYY)+1:length(YYY)+L,1)
D=[YYY;PTTT]
XXX1 = cumsum([XXX(1);D])
XXX2 = XXX1(length(XXX)+1 : end)
for i=1:15
    if i>=10
        XXX2(i)=XXX2(i)-0
    end
end
subplot(223);

compare(mmm,ZZZ,L)
title('OPPO拟合')
hold on

%
L = 15
yyyy = [YYYY;zeros(L,1)];
pppp=iddata(yyyy);
PPPP=predict(mmmm,pppp,L)
GGGG=get(PPPP)
PTTTT = GGGG.OutputData{1,1}(length(YYY)+1:length(YYY)+L,1)
D=[YYYY;PTTTT]
XXXX1 = cumsum([XXXX(1);D])
XXXX2 = XXXX1(length(XXXX)+1 : end)
for i=1:15
    if i>=10
        XXXX2(i)=XXXX2(i)-600
    end
end
subplot(224);

compare(mmmm,ZZZZ,L)
title('华为P8拟合')
hold on

% hObject    handle to pushbutton8 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --- Executes on button press in pushbutton9.
function pushbutton9_Callback(hObject, eventdata, handles)
load emodataf
% X=[ 2000	2000	2050	2050	2050	2050	2000	2050	2050	2000	2000	2000	2000	2000	2050	2050	2000	2000	2000	2000	2050	2050	2000	2000	2050	2050	2050	2050	2000	2000	2050	2000	2050	2050	2000	2050	2025	2000	2000	2000	2050	2000	2000	2050	2000	2050	2000	2050	2000	2050	2050	2050	2050	2050	2050	2050	2050	2000	2050	2050	2000
%     ]';
X=[14.06	14.65	15.45	13.91	13.33	12	11.43	11.14	11.4	10.57	10.65	11.72	12.89	12.58	13.05	13.48	12.13	10.93	9.84	9.98	9.45	9.76	10.74	10.98	10.47	10.14	10.83	10.88	11.25	11.09	11.25	11.4	11.33	10.2	9.98	9.68	10.65	11.4	11.3	10.6	10.6	10.49	10.28	10.26	9.95	10.26	10.12	10.05	10.26	10.57	11.06	10.8	10.85	10.9	11.13	11.09	11.17	11.44	11.61	11.53	11.7	11.7	11.9	12.13	12.24	12.09	12.14	12.03	12.13	11.88	11.96	11.25	11.05	11.32	11.91	11.91	11.81	11.9	12	12.32	12.47	12.39	11.98	11.51	11.51	11.57	11.62	11.57	11.52	11.57	11.33	11.3	11.11	11.1	11.33	11.1	11.1	11.19	11.06	11.4
]';
% XX=[3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3600	3350	3420	3420	3420	3420	3420	3420	3420	3420	3420	3420	3420	3420	3420	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320	3320
%     ]';
XX=[9.63	9.86	10.01	9.07	9.49	8.84	8.99	8.87	9.14	8.59	8.61	9.36	8.95	8.81	9.01	9.11	8.52	8.75	8.37	8.71	8.6	9.04	9.14	9.08	9	8.81	9.05	9.08	9.2	9.05	9.35	9.35	9.38	8.7	8.8	9.08	9.48	10.43	10.35	10.27	10.18	10.06	9.88	9.46	9.35	9.59	9.72	9.65	9.69	9.8	10.01	9.82	9.72	9.55	9.61	9.37	9.13	9.39	9.28	9.32	9.46	9.45	9.37	9.22	9.36	9.24	9.4	9.49	9.49	9.29	9.29	9.15	9.03	9.15	9.05	9.1	9.11	9	8.95	9.09	9.12	9.22	9.05	8.85	8.84	8.86	8.9	8.9	8.96	8.55	8.45	8.34	8.42	8.41	8.3	8.22	8.23	8.19	8.49	8.44
]';
% XXX=[
%     2499	2499	2499	2499	2499	2998	2499	2499	2999	2499	2499	2499	2499	2499	2499	2499	2499	2499	2999	2499	2499	3298	2999	2499	2499	2499	2999	2499	2999	2499	2999	2998	2499	2499	2999	2499	2749	2999	2999	2499	2499	2499	2499	2499	2999	2499	2499	2499	2499	1999	1999	1999	1999	2149	2299	1999	2499	1999	2499	2299	2299
%     ]';
XXX=[6.1	6.02	6.19	5.59	5.68	5.12	5.18	5.07	5.22	4.9	5.02	5.52	5.43	5.09	5.24	5.46	5.01	5.08	4.98	5.08	4.87	5.02	5.11	5.14	5.05	4.92	5.13	5.2	5.15	5.22	5.74	5.56	5.54	4.99	5.05	4.9	5.17	5.69	5.6	5.42	5.53	5.51	5.33	5.11	5.06	5.16	5.12	5.05	5.16	5.36	5.58	5.41	5.46	5.44	5.46	5.33	5.18	5.37	5.39	5.38	5.48	5.49	5.35	5.4	5.46	5.44	5.48	5.54	5.54	5.45	5.46	5.17	5.13	5.19	5.2	5.25	5.2	5.19	5.2	5.28	5.28	5.28	5.1	4.85	4.82	4.81	4.77	4.71	4.75	4.73	4.61	4.61	4.64	4.7	4.65	4.65	4.65	4.64	4.61	4.75
]';
% XXXX=[
%     3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	3588	2888	3588	2888	3588	3588	3588	3588	2888	2888	3800	2970	2970	2970	2970	3800	2970	2970	2970	2970	2970	2970	2970	3385	3800	2970	3800	2970	3800	2970
%     ]';
XXXX=[19.12	18.84	19.23	17.31	17.33	15.84	16.46	15.76	16.35	15.47	15.56	16.28	15.92	15.96	16.91	16.98	15.99	15.81	15.86	16.39	16.26	16.97	17.39	17.37	17	16.59	17.37	17.4	17.24	17.2	17.58	17.21	17.26	15.68	15.97	15.47	15.78	17.36	18.93	18.46	18.39	18.11	17.65	16.83	16.56	17.05	17.06	17.47	17.68	18.05	18.23	17.88	17.86	17.46	17.69	17.21	16.69	17.16	17.2	17.32	17.68	17.59	17.2	17.16	17.39	17.64	17.84	17.88	18.37	18.16	19.98	21.98	20.66	21	20.27	20.57	20.29	19.82	19.39	19.83	20.1	20.43	19.55	18.69	18.63	18.6	18.77	18.64	18.73	19.65	19	19.41	19.38	19.4	19.22	18.82	6.55	6.17	5.94	6.17
]';
% plot(1:length(X),X);

%做对数差分
Y=diff(log(X))
YY=diff(log(XX))
YYY=diff(log(XXX))
YYYY=diff(log(XXXX))
% figure(4)
% plot(1:length(Y),Y)
% 
% figure(3)
% autocorr(Y)


Z=iddata(Y)
ZZ=iddata(YY)
ZZZ=iddata(YYY)
ZZZZ=iddata(YYYY)

figure(1)
% m = armax(Z,[13,9])
 testm = []
    for p = 1:10
        for q = 1:10
            m = armax(Z(1:61),[p,q])     %数据长度T/求长度为共 61天T/10
            AIC = aic(m)
            testm = [testm; p q AIC]
        end
    end
    for k = 1 : size(testm,1)
        if testm(k,3) == min(testm(:,3))
            p_testm = testm(k,1)
            q_testm = testm(k,2)
        end
    end
m = armax(Z,[p_testm q_testm])
% m = armax(Z,'na',13,'nc',9)
 testmm = []
    for p = 1:10
        for q = 1:10
            mm = armax(Z(1:61),[p,q])     %数据长度T/求长度为共 61天T/10
            AIC = aic(mm)
            testmm = [testmm; p q AIC]
        end
    end
    for k = 1 : size(testmm,1)
        if testmm(k,3) == min(testmm(:,3))
            p_testmm = testmm(k,1)
            q_testmm = testmm(k,2)
        end
    end
    
mm = armax(Z,[p_testmm q_testmm])

 testmmm = []
    for p = 1:10
        for q = 1:10
            mmm = armax(Z(1:61),[p,q])     %数据长度T/求长度为共 61天T/10
            AIC = aic(mmm)
            testmmm = [testmmm; p q AIC]
        end
    end
    for k = 1 : size(testmmm,1)
        if testmmm(k,3) == min(testmmm(:,3))
            p_testmmm = testmmm(k,1)
            q_testmmm = testmmm(k,2)
        end
    end

mmm = armax(Z,[p_testmmm q_testmmm])

testmmmm = []
    for p = 1:10
        for q = 1:10
            mmmm = armax(Z(1:61),[p,q])     %数据长度T/求长度为共 61天T/10
            AIC = aic(mmmm)
            testmmmm = [testmmmm; p q AIC]
        end
    end
    for k = 1 : size(testmmmm,1)
        if testmmmm(k,3) == min(testmmmm(:,3))
            p_testmmmm = testmmmm(k,1)
            q_testmmmm = testmmmm(k,2)
        end
    end
mmmm = armax(Z,[p_testmmmm q_testmmmm])

% m = arx(Z,3)



L = 15
y = [Y;zeros(L,1)];
p=iddata(y);
P=predict(m,p,L)

G=get(P)
PT = G.OutputData{1,1}(length(Y)+1:length(Y)+L,1)
D=[Y;PT]
X1 = cumsum([X(1);D])

X2 = X1(length(X)+1 : end)
% for i=1:15
%     if i>=3&i<=7
%         X2(i)=X2(i)-100
%     end
%     if i>7
%         X2(i)=X2(i)-200
%     end
% end


subplot(221);

compare(m,Z,L)
title('宝安地产')
hold on
%
L = 15
yy = [YY;zeros(L,1)];
pp=iddata(yy);
PP=predict(mm,pp,L)
GG=get(PP)
PTT = GG.OutputData{1,1}(length(YY)+1:length(YY)+L,1)
D=[YY;PTT]
XX1 = cumsum([XX(1);D])
XX2 = XX1(length(XX)+1 : end)

subplot(222);

compare(mm,ZZ,L)
title('保利地产')
hold on

%
L = 15
yyy = [YYY;zeros(L,1)];
ppp=iddata(yyy);
PPP=predict(mmm,ppp,L)
GGG=get(PPP)
PTTT = GGG.OutputData{1,1}(length(YYY)+1:length(YYY)+L,1)
D=[YYY;PTTT]
XXX1 = cumsum([XXX(1);D])
XXX2 = XXX1(length(XXX)+1 : end)

subplot(223);

compare(mmm,ZZZ,L)
title('华远地产')
hold on

%
L = 15
yyyy = [YYYY;zeros(L,1)];
pppp=iddata(yyyy);
PPPP=predict(mmmm,pppp,L)
GGGG=get(PPPP)
PTTTT = GGGG.OutputData{1,1}(length(YYY)+1:length(YYY)+L,1)
D=[YYYY;PTTTT]
XXXX1 = cumsum([XXXX(1);D])
XXXX2 = XXXX1(length(XXXX)+1 : end)

subplot(224);

compare(mmmm,ZZZZ,L)
title('格力地产')
hold on

% hObject    handle to pushbutton9 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
